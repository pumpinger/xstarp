<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>xTreeVue.js</title>
    <link rel="stylesheet" href="./font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="./css/x-tree-vue.css">
</head>
<body>
<script type="text/javascript" src="js/jquery-3.1.1.min.js"></script>
<script type="text/javascript" src="js/vue.js"></script>
<script type="text/javascript" src="js/x-tree-vue.js"></script>

<!-- item template -->
<script type="text/x-template" id="x-tree-item-template">
    <div class="x-tree-item">
        <div class="x-tree-item-item" draggable='true'>
            <i v-if="hasChildren" class="fa" :class="model.expand ? 'fa-minus' : 'fa-plus'" @click="expandFn"></i>
            <span v-else class="icon-blank"></span>
            <i class="fa" :class="model.is_check ? 'fa-check-square-o' : 'fa-square-o'" @click="checkFn"></i>
            <span>{{model.name}}</span>
            <i class="fa fa-edit" @click="editFn"></i>
        </div>

        <div class='x-tree-item-children' v-show="model.expand" v-if="hasChildren">
            <x-tree-item class="x-tree-item" v-for="model in model.children" :model="model">
            </x-tree-item>
            <span class="bold" @click="newChildFn">[+]</span>
        </div>

        <div class="x-tree-item-editor" v-show="showEditor">
            <form id="x-tree-item-editor" @submit.prevent="{{editOrAdd ? updateItemFn : addChildFn}}">
                <input type="text" v-model="newChild.id" placeholder="id">
                <input type="text" v-model="newChild.name" placeholder="name">
                <input type="text" v-model="newChild.is_node" placeholder="is_node">
                <input type="text" v-model="newChild.is_check" placeholder="is_check">
                <input type="submit" v-show="editOrAdd" value="UpdateItem">
                <input type="submit" v-show="!editOrAdd" value="Add Child">
            </form>
            <i class="fa fa-edit" @click="deleteFn"></i>
            <ul class="errors">
                <li v-show="!validation.name">Name cannot be empty.</li>
                <li v-show="!validation.email">Please provide a valid email address.</li>
            </ul>
        </div>
    </div>
</script>


<div class="tree-wrap">
    <p>(You can double click on an leaf to turn it into a Node.)</p>

    <!-- the demo root element -->
    <div id="x-tree-demo">
        <x-tree-item class="x-tree-item" :model="treeData">
        </x-tree-item>
    </div>

</div>


<script>
    // demo data

    var arrayData = [
        {id: 26, name: '成都', nodeId: 7, is_node: false, is_check: false},
        {id: 27, name: '泸州', nodeId: 7, is_node: false, is_check: false},
        {id: 28, name: '昆明', nodeId: 7, is_node: false, is_check: false},
        {id: 29, name: '大理', nodeId: 7, is_node: true, is_check: false},
        {id: 30, name: '贵阳', nodeId: 29, is_node: false, is_check: false},
        {id: 31, name: '遵义', nodeId: 29, is_node: false, is_check: false},
        {id: 32, name: '南宁', nodeId: 29, is_node: false, is_check: false},
        {id: 33, name: '桂林', nodeId: 29, is_node: false, is_check: false},

        {id: 1, name: '中国', nodeId: 99, is_node: true, is_check: false},
        {id: 110, name: '大陆', nodeId: 99, is_node: true, is_check: false},
        {id: 111, name: '大陆', nodeId: 110, is_node: false, is_check: false},

        {id: 2, name: '四川', nodeId: 1, is_node: true, is_check: false},
        {id: 3, name: '云南', nodeId: 1, is_node: true, is_check: false},
        {id: 4, name: '贵州', nodeId: 1, is_node: true, is_check: false},
        {id: 5, name: '广西', nodeId: 1, is_node: true, is_check: false},
        {id: 6, name: '成都', nodeId: 2, is_node: false, is_check: false},
        {id: 7, name: '泸州', nodeId: 2, is_node: true, is_check: false},
        {id: 8, name: '昆明', nodeId: 3, is_node: false, is_check: false},
        {id: 9, name: '大理', nodeId: 3, is_node: false, is_check: false},
        {id: 10, name: '贵阳', nodeId: 4, is_node: false, is_check: false},
        {id: 11, name: '遵义', nodeId: 4, is_node: false, is_check: false},
        {id: 12, name: '南宁', nodeId: 5, is_node: false, is_check: false},
        {id: 13, name: '桂林', nodeId: 5, is_node: false, is_check: false},

    ];

    var treeData = _arrayToTree(arrayData);

    var sel_ids = '2,3,11,12,13';

    var treeDataVue = _checkTreeByIds(treeData, sel_ids);


    // define the item component
    Vue.component('x-tree-item', {
        template: '#x-tree-item-template',
        props: {
            model: Object
        },
        data: function () {
            return {
                showEditor: false,
                editOrAdd: false,
                newChild: {
                    id: '',
                    name: '',
                    is_node: '',
                    is_check: '',
                },
                idRE: /^(\w+|[\u4e00-\u9fa5]+)$/,
                nameRE: /^(\w+|[\u4e00-\u9fa5]+)$/,
                nodeRE: /^(\w+|[\u4e00-\u9fa5]+)$/,
                checkRE: /^(\w+|[\u4e00-\u9fa5]+)$/,
            };
        },
        computed: {
            hasChildren: function () {
                return this.model.is_node && this.model.children &&
                    this.model.children.length
            },
            validation: function () {
                return {
                    id: !!this.newChild.name.trim(),
                    name: !!this.newChild.name.trim(),
                    node: this.nodeRE.test(this.newChild.is_node),
                    check: this.checkRE.test(this.newChild.is_check),
                }
            },
            isValid: function () {
                var validation = this.validation
                return Object.keys(validation).every(function (key) {
                    return validation[key]
                })
            }
        },
        methods: {
            expandFn: function () {
                if (this.hasChildren) {
                    this.model.expand = !this.model.expand;
                }
            },
            checkFn: function () {
                _changeItem(this.model, !this.model.is_check);
            },

            editFn: function () {
                this.editOrAdd = true;
                this.newChild = {
                    id: this.model.id,
                    name: this.model.name,
                    is_node: this.model.is_node,
                    is_check: this.model.is_check,
                };
                this.showEditor = !this.showEditor;
            },


            updateItemFn: function () {
                this.showEditor = !this.showEditor;
                this.model.id = this.newChild.id;
                this.model.name = this.newChild.name;
                this.model.is_node = this.newChild.is_node;
                this.model.is_check = this.newChild.is_check;
            },

            deleteFn: function () {
                var index = this.model.parent.children.indexOf(this.model);
                this.model.parent.children.splice(index ,1);
            },

            newChildFn: function () {
                this.editOrAdd = false;
                this.showEditor = !this.showEditor;
            },

            addChildFn: function () {
                this.showEditor = !this.showEditor;
                var newChildTemp = {
                    id: this.newChild.id,
                    name: this.newChild.name,
                    nodeId: '',
                    is_node: this.newChild.is_node,
                    is_check: this.newChild.is_check,
                    expand: '',
                    level: '',
                    parent: '',
                    children: '',
                };
                this.model.children.push(newChildTemp);
            }
        }
    });

    // boot up the demo
    var xTreeDemo = new Vue({
        el: '#x-tree-demo',
        data: {
            treeData: treeDataVue
        }
    });
    console.log('xTreeDemo: ', xTreeDemo);
</script>

</body>
</html>